#include "quadrotor.h"

//========================================
// Planar quadrotor model parameters
//========================================

//========================================
// Codes generated from julia/quadrotor_quat/quadrotor_gen
// Discrete dynamics of quadrotor
//========================================
// 50 Hz
// void tiny_QuadNonlinearDynamics_Raw(float* xn, const float* x,
//                                     const float* u) {
//   xn[0] = -1.76450005149623e-5 * u[1] + 1.938030053644524e-5 * u[0] + 1.7240280835128086e-5 * u[3] + 1.283147958798e-5 * x[10] + -1.8975580856611017e-5 * u[2] + 0.0038494438763940005 * x[4] + 0.02 * x[6] + x[0];
//   xn[1] = 1.7412345210270165e-5 * u[1] + 1.900310248895516e-5 * u[0] + -1.726780246747223e-5 * u[3] + -1.283147958798e-5 * x[9] + -1.91476452317531e-5 * u[2] + -0.0038494438763940005 * x[3] + 0.02 * x[7] + x[1];
//   xn[2] = 0.0009623609690985001 * u[0] + 0.0009623609690985001 * u[1] + 0.0009623609690985001 * u[2] + 0.0009623609690985001 * u[3] + 0.02 * x[8] + x[2];
//   xn[3] = -0.02714004272209002 * u[1] + -0.02961950312691372 * u[0] + 0.026914748761550443 * u[3] + 0.01 * x[9] + 0.029844797087453297 * u[2] + x[3];
//   xn[4] = -0.027502674799079925 * u[1] + 0.0302074291644432 * u[0] + 0.026871851709569117 * u[3] + 0.01 * x[10] + -0.029576606074932392 * u[2] + x[4];
//   xn[5] = -0.004066488426245592 * u[0] + 0.0052950998649359945 * u[1] + 0.0006263763979124646 * u[3] + -0.0018549878366028673 * u[2] + 0.01 * x[11] + x[5];
//   xn[6] = -0.0037340493851740417 * u[1] + 0.004101274989549419 * u[0] + 0.0036484022767836904 * u[3] + 0.001999278061803 * x[10] + -0.004015627881159066 * u[2] + 0.3924 * x[4] + x[6];
//   xn[7] = 0.0036848146800400584 * u[1] + 0.00402145203141888 * u[0] + -0.0036542264270435047 * u[3] + -0.001999278061803 * x[9] + -0.004052040284415435 * u[2] + -0.3924 * x[3] + x[7];
//   xn[8] = 0.09623609690985001 * u[0] + 0.09623609690985001 * u[1] + 0.09623609690985001 * u[2] + 0.09623609690985001 * u[3] + x[8];
//   xn[9] = -5.428008544418003 * u[1] + -5.923900625382744 * u[0] + 5.382949752310089 * u[3] + 5.968959417490659 * u[2] + x[9];
//   xn[10] = -5.500534959815985 * u[1] + 6.0414858328886405 * u[0] + 5.374370341913823 * u[3] + -5.915321214986478 * u[2] + x[10];
//   xn[11] = -0.8132976852491184 * u[0] + 1.0590199729871987 * u[1] + 0.1252752795824929 * u[3] + -0.3709975673205735 * u[2] + x[11];
// }

// 100 Hz
void tiny_QuadNonlinearDynamics_Raw(float* xn, const float* x,
                                    const float* u) {
  xn[0] = -1.0775175521955054e-6 * u[0] + 1.1859738035381885e-6 * u[1] + 1.1028125321851438e-6 * u[2] + -1.2112687835278274e-6 * u[3] + 0.0009623609690985001 * x[4] + 0.01 * x[6] + 1.6039349484975e-6 * x[10] + x[0];
  xn[1] = 1.0792376542170143e-6 * u[0] + 1.1967278269845687e-6 * u[1] + -1.0882715756418853e-6 * u[2] + -1.1876939055596974e-6 * u[3] + -0.0009623609690985001 * x[3] + -1.6039349484975e-6 * x[9] + 0.01 * x[7] + x[1];
  xn[2] = 0.00024059024227462503 * u[0] + 0.00024059024227462503 * u[1] + 0.00024059024227462503 * u[2] + 0.00024059024227462503 * u[3] + 0.01 * x[8] + x[2];
  xn[3] = -0.006728687190387611 * u[0] + -0.007461199271863324 * u[1] + 0.005 * x[9] + 0.006785010680522505 * u[2] + 0.00740487578172843 * u[3] + x[3];
  xn[4] = -0.006717962927392279 * u[0] + 0.007394151518733098 * u[1] + 0.005 * x[10] + 0.006875668699769981 * u[2] + -0.0075518572911108 * u[3] + x[4];
  xn[5] = -0.00015659409947811615 * u[0] + 0.0004637469591507168 * u[1] + 0.001016622106561398 * u[3] + -0.0013237749662339986 * u[2] + 0.005 * x[11] + x[5];
  xn[6] = -0.0004560502845979613 * u[0] + 0.0005019534851448832 * u[1] + 0.0004667561731467552 * u[2] + -0.0005126593736936774 * u[3] + 0.1962 * x[4] + 0.00049981951545075 * x[10] + x[6];
  xn[7] = 0.0004567783033804381 * u[0] + 0.0005065050355519293 * u[1] + -0.0004606018350050073 * u[2] + -0.00050268150392736 * u[3] + -0.1962 * x[3] + -0.00049981951545075 * x[9] + x[7];
  xn[8] = 0.048118048454925004 * u[0] + 0.048118048454925004 * u[1] + 0.048118048454925004 * u[2] + 0.048118048454925004 * u[3] + x[8];
  xn[9] = -2.6914748761550444 * u[0] + -2.9844797087453294 * u[1] + 2.7140042722090016 * u[2] + 2.961950312691372 * u[3] + x[9];
  xn[10] = -2.6871851709569117 * u[0] + 2.957660607493239 * u[1] + 2.7502674799079925 * u[2] + -3.0207429164443202 * u[3] + x[10];
  xn[11] = -0.06263763979124645 * u[0] + 0.18549878366028674 * u[1] + 0.4066488426245592 * u[3] + -0.5295099864935994 * u[2] + x[11];
}


void tiny_QuadNonlinearDynamics(Matrix* xn, const Matrix x, const Matrix u) {
  tiny_QuadNonlinearDynamics_Raw(xn->data, x.data, u.data);
}